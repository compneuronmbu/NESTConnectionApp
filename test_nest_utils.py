import time
import nest_utils as nu
import json

nett_spec = {"syn_models": [["static_synapse", "static_excitatory", {}]], "models": {"excitatory": "iaf_psc_alpha"}, "layers": [{"neurons": [{"x": -2.0, "y": -2.0, "z": -2.0}, {"x": -2.0, "y": -2.0, "z": -1.0}, {"x": -2.0, "y": -2.0, "z": 0.0}, {"x": -2.0, "y": -2.0, "z": 1.0}, {"x": -2.0, "y": -2.0, "z": 2.0}, {"x": -2.0, "y": -1.0, "z": -2.0}, {"x": -2.0, "y": -1.0, "z": -1.0}, {"x": -2.0, "y": -1.0, "z": 0.0}, {"x": -2.0, "y": -1.0, "z": 1.0}, {"x": -2.0, "y": -1.0, "z": 2.0}, {"x": -2.0, "y": 0.0, "z": -2.0}, {"x": -2.0, "y": 0.0, "z": -1.0}, {"x": -2.0, "y": 0.0, "z": 0.0}, {"x": -2.0, "y": 0.0, "z": 1.0}, {"x": -2.0, "y": 0.0, "z": 2.0}, {"x": -2.0, "y": 1.0, "z": -2.0}, {"x": -2.0, "y": 1.0, "z": -1.0}, {"x": -2.0, "y": 1.0, "z": 0.0}, {"x": -2.0, "y": 1.0, "z": 1.0}, {"x": -2.0, "y": 1.0, "z": 2.0}, {"x": -2.0, "y": 2.0, "z": -2.0}, {"x": -2.0, "y": 2.0, "z": -1.0}, {"x": -2.0, "y": 2.0, "z": 0.0}, {"x": -2.0, "y": 2.0, "z": 1.0}, {"x": -2.0, "y": 2.0, "z": 2.0}, {"x": -1.0, "y": -2.0, "z": -2.0}, {"x": -1.0, "y": -2.0, "z": -1.0}, {"x": -1.0, "y": -2.0, "z": 0.0}, {"x": -1.0, "y": -2.0, "z": 1.0}, {"x": -1.0, "y": -2.0, "z": 2.0}, {"x": -1.0, "y": -1.0, "z": -2.0}, {"x": -1.0, "y": -1.0, "z": -1.0}, {"x": -1.0, "y": -1.0, "z": 0.0}, {"x": -1.0, "y": -1.0, "z": 1.0}, {"x": -1.0, "y": -1.0, "z": 2.0}, {"x": -1.0, "y": 0.0, "z": -2.0}, {"x": -1.0, "y": 0.0, "z": -1.0}, {"x": -1.0, "y": 0.0, "z": 0.0}, {"x": -1.0, "y": 0.0, "z": 1.0}, {"x": -1.0, "y": 0.0, "z": 2.0}, {"x": -1.0, "y": 1.0, "z": -2.0}, {"x": -1.0, "y": 1.0, "z": -1.0}, {"x": -1.0, "y": 1.0, "z": 0.0}, {"x": -1.0, "y": 1.0, "z": 1.0}, {"x": -1.0, "y": 1.0, "z": 2.0}, {"x": -1.0, "y": 2.0, "z": -2.0}, {"x": -1.0, "y": 2.0, "z": -1.0}, {"x": -1.0, "y": 2.0, "z": 0.0}, {"x": -1.0, "y": 2.0, "z": 1.0}, {"x": -1.0, "y": 2.0, "z": 2.0}, {"x": 0.0, "y": -2.0, "z": -2.0}, {"x": 0.0, "y": -2.0, "z": -1.0}, {"x": 0.0, "y": -2.0, "z": 0.0}, {"x": 0.0, "y": -2.0, "z": 1.0}, {"x": 0.0, "y": -2.0, "z": 2.0}, {"x": 0.0, "y": -1.0, "z": -2.0}, {"x": 0.0, "y": -1.0, "z": -1.0}, {"x": 0.0, "y": -1.0, "z": 0.0}, {"x": 0.0, "y": -1.0, "z": 1.0}, {"x": 0.0, "y": -1.0, "z": 2.0}, {"x": 0.0, "y": 0.0, "z": -2.0}, {"x": 0.0, "y": 0.0, "z": -1.0}, {"x": 0.0, "y": 0.0, "z": 0.0}, {"x": 0.0, "y": 0.0, "z": 1.0}, {"x": 0.0, "y": 0.0, "z": 2.0}, {"x": 0.0, "y": 1.0, "z": -2.0}, {"x": 0.0, "y": 1.0, "z": -1.0}, {"x": 0.0, "y": 1.0, "z": 0.0}, {"x": 0.0, "y": 1.0, "z": 1.0}, {"x": 0.0, "y": 1.0, "z": 2.0}, {"x": 0.0, "y": 2.0, "z": -2.0}, {"x": 0.0, "y": 2.0, "z": -1.0}, {"x": 0.0, "y": 2.0, "z": 0.0}, {"x": 0.0, "y": 2.0, "z": 1.0}, {"x": 0.0, "y": 2.0, "z": 2.0}, {"x": 1.0, "y": -2.0, "z": -2.0}, {"x": 1.0, "y": -2.0, "z": -1.0}, {"x": 1.0, "y": -2.0, "z": 0.0}, {"x": 1.0, "y": -2.0, "z": 1.0}, {"x": 1.0, "y": -2.0, "z": 2.0}, {"x": 1.0, "y": -1.0, "z": -2.0}, {"x": 1.0, "y": -1.0, "z": -1.0}, {"x": 1.0, "y": -1.0, "z": 0.0}, {"x": 1.0, "y": -1.0, "z": 1.0}, {"x": 1.0, "y": -1.0, "z": 2.0}, {"x": 1.0, "y": 0.0, "z": -2.0}, {"x": 1.0, "y": 0.0, "z": -1.0}, {"x": 1.0, "y": 0.0, "z": 0.0}, {"x": 1.0, "y": 0.0, "z": 1.0}, {"x": 1.0, "y": 0.0, "z": 2.0}, {"x": 1.0, "y": 1.0, "z": -2.0}, {"x": 1.0, "y": 1.0, "z": -1.0}, {"x": 1.0, "y": 1.0, "z": 0.0}, {"x": 1.0, "y": 1.0, "z": 1.0}, {"x": 1.0, "y": 1.0, "z": 2.0}, {"x": 1.0, "y": 2.0, "z": -2.0}, {"x": 1.0, "y": 2.0, "z": -1.0}, {"x": 1.0, "y": 2.0, "z": 0.0}, {"x": 1.0, "y": 2.0, "z": 1.0}, {"x": 1.0, "y": 2.0, "z": 2.0}, {"x": 2.0, "y": -2.0, "z": -2.0}, {"x": 2.0, "y": -2.0, "z": -1.0}, {"x": 2.0, "y": -2.0, "z": 0.0}, {"x": 2.0, "y": -2.0, "z": 1.0}, {"x": 2.0, "y": -2.0, "z": 2.0}, {"x": 2.0, "y": -1.0, "z": -2.0}, {"x": 2.0, "y": -1.0, "z": -1.0}, {"x": 2.0, "y": -1.0, "z": 0.0}, {"x": 2.0, "y": -1.0, "z": 1.0}, {"x": 2.0, "y": -1.0, "z": 2.0}, {"x": 2.0, "y": 0.0, "z": -2.0}, {"x": 2.0, "y": 0.0, "z": -1.0}, {"x": 2.0, "y": 0.0, "z": 0.0}, {"x": 2.0, "y": 0.0, "z": 1.0}, {"x": 2.0, "y": 0.0, "z": 2.0}, {"x": 2.0, "y": 1.0, "z": -2.0}, {"x": 2.0, "y": 1.0, "z": -1.0}, {"x": 2.0, "y": 1.0, "z": 0.0}, {"x": 2.0, "y": 1.0, "z": 1.0}, {"x": 2.0, "y": 1.0, "z": 2.0}, {"x": 2.0, "y": 2.0, "z": -2.0}, {"x": 2.0, "y": 2.0, "z": -1.0}, {"x": 2.0, "y": 2.0, "z": 0.0}, {"x": 2.0, "y": 2.0, "z": 1.0}, {"x": 2.0, "y": 2.0, "z": 2.0}], "elements": "excitatory", "center": [0.0, 0.0, 0.0], "extent": [5.0, 5.0, 5.0], "name": "exAndIn", "neuronType": ""}], "projections": [["exAndIn", "exAndIn", {"synapse_model": "static_synapse", "kernel": 0.1, "delays": 1.5, "connection_type": "convergent", "weights": 0.1}]], "is3DLayer": True}
nett_spec_json = json.dumps(nett_spec)

projections = {'poisson_generator_1': {'specs': {'model': 'poisson_generator', 'params': {'rate': 70000}}, 'connectees': [{'noOfNeuronTypesInLayer': {'exAndIn': 1}, 'selection': {'ll': {'y': -0.1, 'x': -0.1, 'z': -0.1}, 'ur': {'y': 0.1, 'x': 0.1, 'z': 0.1}}, 'name': ['exAndIn'], 'polarAngle': 0, 'synModel': 'static_excitatory', 'maskShape': 'box', 'azimuthAngle': 0, 'neuronType': 'All'}]},
               'spike_detector_2': {'specs': {'model': 'spike_detector', 'params': {}}, 'connectees': [{'noOfNeuronTypesInLayer': {'exAndIn': 1}, 'selection': {'ll': {'y': -0.1, 'x': -0.1, 'z': -0.1}, 'ur': {'y': 0.1, 'x': 0.1, 'z': 0.1}}, 'name': ['exAndIn'], 'synModel': 'static_excitatory', 'maskShape': 'box', 'azimuthAngle': 0, 'neuronType': 'All'}]}}
projections_json = json.dumps(projections)

selection = {"noOfNeuronTypesInLayer": {"Excitatory": 1}, "selection": {"ll": {"y": 0.4313553719421309, "x": -0.5395088164334471, "z": 0}, "ur": {"y": 0.5156593534291923, "x": -0.45801496766262073, "z": 0}}, "name": ["Excitatory"], "synModel": "static_excitatory", "maskShape": "rectangular", "azimuthAngle": 1.5707963267948966, "neuronType": "All"}
selection_json = json.dumps(selection)

ni = nu.NESTInterface(nett_spec_json, device_projections=projections_json)

ni.printGIDs(selection_json)

ni.connect_all()
num_connections = ni.get_num_connections()

ni.simulate(150)

ni.terminate_nest_client()
print('** end of script **')
